sumeru.config({httpServerPort:8080,sumeruPath:"/../sumeru"}),sumeru.router.add({pattern:"/itworks",action:"App.itworks"}),App.itworks=sumeru.controller.create(function(e,t){e.onrender=function(e){e("itworks",["push","left"])}}),sumeru.router.add({pattern:"/chatroom",action:"App.chatroom"}),sumeru.router.setDefault("App.chatroom"),App.chatroom=sumeru.controller.create(function(e,t){var n=function(){t.chatMessages=e.subscribe("pub-chatRoom",function(e){t.bind("chatroom_container",{data:e.find()})})};e.onload=function(){return[n]},e.onrender=function(e){e("chatroom",["push","left"])},e.onready=function(){t.event("chatroom_container",function(){document.getElementById("messages").style.height=document.body.clientHeight-80+"px",document.getElementById("messages").scrollTop=document.getElementById("messages").scrollHeight}),window.onresize=function(){document.getElementById("messages").style.height=document.body.clientHeight-80+"px",document.getElementById("messages").scrollTop=document.getElementById("messages").scrollHeight},t.eventMap("#inputMessage",{keydown:function(e){13==e.keyCode&&r()},focus:function(e){},blur:function(e){""==this.value.trim()}}),document.getElementById("send").addEventListener("click",r)};var r=function(){var e=document.getElementById("inputMessage"),n=e.value.trim(),r=document.getElementById("inputName"),i=r.value.trim();return""==n||""==i?(alert("用户名和消息不能为空！"),!1):(t.chatMessages.add({username:i,message:n,time:(new Date).valueOf()}),t.chatMessages.save(),e.value="",e.focus(),void 0)}}),Model.chatroomModel=function(e){e.config={fields:[{name:"username",type:"string"},{name:"message",type:"string"},{name:"time",type:"datetime",defaultValue:"now()"}]}},Library.getChatTime=sumeru.Library.create(function(e){return e.getTime=function(e){var t=new Date(e),n=new Date;return getMinutes=t.getMinutes(),0===getMinutes?getMinutes+="0":getMinutes>0&&10>getMinutes&&(getMinutes="0"+getMinutes),t.getYear()==n.getYear()&&t.getMonth()==n.getMonth()&&t.getDate()==n.getDate()?t.getHours()+":"+getMinutes:t.getMonth()+1+"-"+t.getDate()+"  "+t.getHours()+":"+getMinutes},e});